<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twin Severe Outcome Prediction Diagnostic Tool - Demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .main-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin: 20px auto;
            padding: 30px;
            backdrop-filter: blur(10px);
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }
        
        .header h1 {
            color: #2c3e50;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #7f8c8d;
            font-size: 1.1em;
        }
        
        .demo-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .patient-card {
            background: #ffffff;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .risk-card {
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .risk-low {
            background: linear-gradient(135deg, #56ab2f, #a8e6cf);
            color: white;
        }
        
        .risk-medium {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
        }
        
        .risk-high {
            background: linear-gradient(135deg, #ff416c, #ff4b2b);
            color: white;
        }
        
        .risk-score {
            font-size: 3em;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .risk-level {
            font-size: 1.5em;
            font-weight: 600;
        }
        
        .shap-chart {
            background: #ffffff;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .feature-table {
            background: #ffffff;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .feature-table th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }
        
        .btn-demo {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            border-radius: 25px;
            padding: 15px 40px;
            font-weight: 600;
            font-size: 1.1em;
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .btn-demo:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
            color: white;
        }
        
        .alert-custom {
            border-radius: 10px;
            border: none;
            padding: 15px 20px;
        }
        
        .model-info {
            background: #e3f2fd;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .model-info h6 {
            color: #1976d2;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-container">
            <!-- Header -->
            <div class="header">
                <h1><i class="fas fa-heartbeat"></i> Twin Severe Outcome Prediction Diagnostic Tool</h1>
                <p>Clinical Decision Support System - Demo Version</p>
            </div>
            
            <!-- Model Information -->
            <div class="model-info">
                <h6><i class="fas fa-info-circle"></i> Model Information</h6>
                <small>This demo is based on LASSO feature selection and GradientBoosting algorithm, using 10 key clinical features for prediction. The model achieves 92.64% accuracy on the training set.</small>
            </div>
            
            <!-- Demo Section -->
            <div class="demo-section">
                <h4><i class="fas fa-play-circle"></i> Demo Patient Analysis</h4>
                <p>This demo shows a randomly selected patient case with prediction results and SHAP explanations.</p>
                
                <div class="text-center mb-4">
                    <button class="btn btn-demo" onclick="generateNewPatient()">
                        <i class="fas fa-refresh"></i> Generate New Patient
                    </button>
                </div>
                
                <!-- Patient Information -->
                <div class="patient-card">
                    <h5><i class="fas fa-user-md"></i> Patient Information</h5>
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Feature</th>
                                    <th>Value</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody id="patientTable">
                                <!-- Patient data will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Risk Assessment -->
                <div class="risk-card" id="riskCard">
                    <div class="risk-score" id="riskScore">0.00</div>
                    <div class="risk-level" id="riskLevel">Unknown</div>
                    <div class="mt-3">
                        <small>Prediction Confidence: <span id="confidence">-</span></small>
                    </div>
                </div>
                
                <!-- SHAP Explanation -->
                <div class="shap-chart">
                    <h5><i class="fas fa-brain"></i> Feature Importance Explanation</h5>
                    <div id="shapChart"></div>
                </div>
                
                <!-- Clinical Recommendations -->
                <div class="alert alert-info alert-custom mt-3">
                    <h6><i class="fas fa-lightbulb"></i> Clinical Recommendations</h6>
                    <div id="clinicalAdvice">
                        <p>Please develop individualized treatment plans based on prediction results and feature importance analysis, combined with clinical experience.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Sample patient data pool
        const patientPool = [
            {
                "Gestational Age": 37.2,
                "Chorionicity": 1,
                "GestationalHypertension": 0,
                "GestationalHypothyroidism": 0,
                "IntrahepaticCholestasis": 0,
                "GestationalAnemia": 1,
                "MeconiumStainingIII": 0,
                "FetalWeight": 2850,
                "NeonatalHypoglycemia": 0,
                "CongenitalMalformation": 0
            },
            {
                "Gestational Age": 34.8,
                "Chorionicity": 0,
                "GestationalHypertension": 1,
                "GestationalHypothyroidism": 0,
                "IntrahepaticCholestasis": 1,
                "GestationalAnemia": 0,
                "MeconiumStainingIII": 1,
                "FetalWeight": 2100,
                "NeonatalHypoglycemia": 1,
                "CongenitalMalformation": 1
            },
            {
                "Gestational Age": 39.1,
                "Chorionicity": 1,
                "GestationalHypertension": 0,
                "GestationalHypothyroidism": 1,
                "IntrahepaticCholestasis": 0,
                "GestationalAnemia": 0,
                "MeconiumStainingIII": 0,
                "FetalWeight": 3200,
                "NeonatalHypoglycemia": 0,
                "CongenitalMalformation": 0
            },
            {
                "Gestational Age": 32.5,
                "Chorionicity": 0,
                "GestationalHypertension": 1,
                "GestationalHypothyroidism": 0,
                "IntrahepaticCholestasis": 0,
                "GestationalAnemia": 1,
                "MeconiumStainingIII": 1,
                "FetalWeight": 1800,
                "NeonatalHypoglycemia": 1,
                "CongenitalMalformation": 0
            },
            {
                "Gestational Age": 38.7,
                "Chorionicity": 1,
                "GestationalHypertension": 0,
                "GestationalHypothyroidism": 0,
                "IntrahepaticCholestasis": 0,
                "GestationalAnemia": 0,
                "MeconiumStainingIII": 0,
                "FetalWeight": 2950,
                "NeonatalHypoglycemia": 0,
                "CongenitalMalformation": 0
            }
        ];
        
        // Feature descriptions
        const featureDescriptions = {
            'Gestational Age': 'Gestational Age (weeks)',
            'Chorionicity': 'Chorionicity (0=Monochorionic, 1=Dichorionic)',
            'GestationalHypertension': 'Gestational Hypertension (0=No, 1=Yes)',
            'GestationalHypothyroidism': 'Gestational Hypothyroidism (0=No, 1=Yes)',
            'IntrahepaticCholestasis': 'Intrahepatic Cholestasis (0=No, 1=Yes)',
            'GestationalAnemia': 'Gestational Anemia (0=No, 1=Yes)',
            'MeconiumStainingIII': 'Meconium Staining Grade III (0=No, 1=Yes)',
            'FetalWeight': 'Fetal Weight (grams)',
            'NeonatalHypoglycemia': 'Neonatal Hypoglycemia (0=No, 1=Yes)',
            'CongenitalMalformation': 'Congenital Malformation (0=No, 1=Yes)'
        };
        
        // Simulate prediction based on patient data
        function simulatePrediction(patientData) {
            // Simple rule-based prediction simulation
            let riskScore = 0.1; // Base risk
            
            // Risk factors
            if (patientData['Gestational Age'] < 35) riskScore += 0.3;
            if (patientData['Chorionicity'] === 0) riskScore += 0.2; // Monochorionic
            if (patientData['GestationalHypertension'] === 1) riskScore += 0.25;
            if (patientData['GestationalHypothyroidism'] === 1) riskScore += 0.15;
            if (patientData['IntrahepaticCholestasis'] === 1) riskScore += 0.2;
            if (patientData['GestationalAnemia'] === 1) riskScore += 0.1;
            if (patientData['MeconiumStainingIII'] === 1) riskScore += 0.3;
            if (patientData['FetalWeight'] < 2000) riskScore += 0.25;
            if (patientData['NeonatalHypoglycemia'] === 1) riskScore += 0.2;
            if (patientData['CongenitalMalformation'] === 1) riskScore += 0.4;
            
            // Normalize to 0-1 range
            riskScore = Math.min(riskScore, 0.95);
            riskScore = Math.max(riskScore, 0.05);
            
            return riskScore;
        }
        
        // Generate SHAP values simulation
        function generateSHAPValues(patientData, riskScore) {
            const features = Object.keys(patientData);
            const shapValues = [];
            
            features.forEach(feature => {
                let shapValue = 0;
                
                // Calculate SHAP-like values based on feature impact
                switch(feature) {
                    case 'Gestational Age':
                        shapValue = patientData[feature] < 35 ? 0.15 : -0.05;
                        break;
                    case 'Chorionicity':
                        shapValue = patientData[feature] === 0 ? 0.12 : -0.08;
                        break;
                    case 'GestationalHypertension':
                        shapValue = patientData[feature] === 1 ? 0.18 : -0.02;
                        break;
                    case 'GestationalHypothyroidism':
                        shapValue = patientData[feature] === 1 ? 0.10 : -0.01;
                        break;
                    case 'IntrahepaticCholestasis':
                        shapValue = patientData[feature] === 1 ? 0.15 : -0.01;
                        break;
                    case 'GestationalAnemia':
                        shapValue = patientData[feature] === 1 ? 0.08 : -0.01;
                        break;
                    case 'MeconiumStainingIII':
                        shapValue = patientData[feature] === 1 ? 0.22 : -0.02;
                        break;
                    case 'FetalWeight':
                        shapValue = patientData[feature] < 2000 ? 0.20 : -0.05;
                        break;
                    case 'NeonatalHypoglycemia':
                        shapValue = patientData[feature] === 1 ? 0.16 : -0.01;
                        break;
                    case 'CongenitalMalformation':
                        shapValue = patientData[feature] === 1 ? 0.30 : -0.02;
                        break;
                }
                
                shapValues.push({
                    feature: featureDescriptions[feature],
                    shap_value: shapValue,
                    feature_value: patientData[feature],
                    importance: Math.abs(shapValue)
                });
            });
            
            // Sort by importance
            shapValues.sort((a, b) => b.importance - a.importance);
            
            return shapValues;
        }
        
        function generateNewPatient() {
            // Select random patient
            const patientData = patientPool[Math.floor(Math.random() * patientPool.length)];
            
            // Simulate prediction
            const riskScore = simulatePrediction(patientData);
            const prediction = {
                risk_score: riskScore,
                risk_level: getRiskLevel(riskScore),
                confidence: getConfidence(riskScore)
            };
            
            // Generate SHAP values
            const shapData = generateSHAPValues(patientData, riskScore);
            
            // Update UI
            updatePatientTable(patientData);
            updateRiskCard(prediction);
            drawShapChart(shapData);
            generateClinicalAdvice(prediction, shapData);
        }
        
        function updatePatientTable(patientData) {
            const tbody = document.getElementById('patientTable');
            tbody.innerHTML = '';
            
            Object.entries(patientData).forEach(([feature, value]) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${featureDescriptions[feature]}</strong></td>
                    <td>${formatValue(feature, value)}</td>
                    <td>${getFeatureDescription(feature, value)}</td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function formatValue(feature, value) {
            if (feature === 'Gestational Age') {
                return `${value} weeks`;
            } else if (feature === 'FetalWeight') {
                return `${value} g`;
            } else {
                return value === 1 ? 'Yes' : 'No';
            }
        }
        
        function getFeatureDescription(feature, value) {
            const descriptions = {
                'Gestational Age': value < 35 ? 'Preterm (< 35 weeks)' : 'Term (â‰¥ 35 weeks)',
                'Chorionicity': value === 0 ? 'Monochorionic (higher risk)' : 'Dichorionic (lower risk)',
                'GestationalHypertension': value === 1 ? 'Present (risk factor)' : 'Absent',
                'GestationalHypothyroidism': value === 1 ? 'Present (risk factor)' : 'Absent',
                'IntrahepaticCholestasis': value === 1 ? 'Present (risk factor)' : 'Absent',
                'GestationalAnemia': value === 1 ? 'Present (risk factor)' : 'Absent',
                'MeconiumStainingIII': value === 1 ? 'Present (severe risk factor)' : 'Absent',
                'FetalWeight': value < 2000 ? 'Low birth weight (risk factor)' : 'Normal weight',
                'NeonatalHypoglycemia': value === 1 ? 'Present (risk factor)' : 'Absent',
                'CongenitalMalformation': value === 1 ? 'Present (major risk factor)' : 'Absent'
            };
            return descriptions[feature] || '';
        }
        
        function updateRiskCard(prediction) {
            const riskScore = (prediction.risk_score * 100).toFixed(1);
            document.getElementById('riskScore').textContent = riskScore + '%';
            document.getElementById('riskLevel').textContent = prediction.risk_level;
            document.getElementById('confidence').textContent = prediction.confidence;
            
            // Set risk card style
            const riskCard = document.getElementById('riskCard');
            riskCard.className = 'risk-card';
            if (prediction.risk_level === 'Low Risk') {
                riskCard.classList.add('risk-low');
            } else if (prediction.risk_level === 'Medium Risk') {
                riskCard.classList.add('risk-medium');
            } else {
                riskCard.classList.add('risk-high');
            }
        }
        
        function drawShapChart(shapData) {
            const features = shapData.map(item => item.feature);
            const shapValues = shapData.map(item => item.shap_value);
            const colors = shapValues.map(value => value > 0 ? '#ff6b6b' : '#4ecdc4');
            
            const trace = {
                x: shapValues,
                y: features,
                type: 'bar',
                orientation: 'h',
                marker: {
                    color: colors,
                    line: {
                        color: 'rgba(0,0,0,0.1)',
                        width: 1
                    }
                },
                text: shapValues.map(value => value.toFixed(3)),
                textposition: 'outside'
            };
            
            const layout = {
                title: {
                    text: 'Feature Impact on Prediction Results',
                    font: { size: 16 }
                },
                xaxis: {
                    title: 'SHAP Value (Positive increases risk, Negative decreases risk)',
                    gridcolor: 'rgba(0,0,0,0.1)'
                },
                yaxis: {
                    title: 'Clinical Features',
                    gridcolor: 'rgba(0,0,0,0.1)'
                },
                margin: { l: 200, r: 50, t: 50, b: 50 },
                plot_bgcolor: 'rgba(0,0,0,0)',
                paper_bgcolor: 'rgba(0,0,0,0)'
            };
            
            Plotly.newPlot('shapChart', [trace], layout, {responsive: true});
        }
        
        function generateClinicalAdvice(prediction, shapData) {
            const adviceDiv = document.getElementById('clinicalAdvice');
            let advice = '';
            
            if (prediction.risk_level === 'High Risk') {
                advice += '<p><strong>High Risk Patient Recommendations:</strong></p><ul>';
                advice += '<li>Recommend immediate detailed assessment and close monitoring</li>';
                advice += '<li>Consider early hospitalization for observation</li>';
                advice += '<li>Develop emergency response plan</li>';
            } else if (prediction.risk_level === 'Medium Risk') {
                advice += '<p><strong>Medium Risk Patient Recommendations:</strong></p><ul>';
                advice += '<li>Recommend regular follow-up monitoring</li>';
                advice += '<li>Increase frequency of prenatal checkups</li>';
                advice += '<li>Monitor for related symptoms</li>';
            } else {
                advice += '<p><strong>Low Risk Patient Recommendations:</strong></p><ul>';
                advice += '<li>Follow routine prenatal care schedule</li>';
                advice += '<li>Maintain healthy lifestyle habits</li>';
                advice += '<li>Seek medical attention if abnormalities occur</li>';
            }
            
            // Add key feature recommendations
            const topFeatures = shapData.slice(0, 3);
            advice += '</ul><p><strong>Key Focus Areas:</strong></p><ul>';
            topFeatures.forEach(feature => {
                if (feature.shap_value > 0) {
                    advice += `<li>${feature.feature} is an important risk-increasing factor</li>`;
                } else {
                    advice += `<li>${feature.feature} helps reduce risk</li>`;
                }
            });
            advice += '</ul>';
            
            adviceDiv.innerHTML = advice;
        }
        
        function getRiskLevel(riskScore) {
            if (riskScore < 0.3) {
                return "Low Risk";
            } else if (riskScore < 0.7) {
                return "Medium Risk";
            } else {
                return "High Risk";
            }
        }
        
        function getConfidence(riskScore) {
            const distance = Math.abs(riskScore - 0.5);
            if (distance > 0.3) {
                return "High";
            } else if (distance > 0.1) {
                return "Medium";
            } else {
                return "Low";
            }
        }
        
        // Initialize with first patient
        window.onload = function() {
            generateNewPatient();
        };
    </script>
</body>
</html>















